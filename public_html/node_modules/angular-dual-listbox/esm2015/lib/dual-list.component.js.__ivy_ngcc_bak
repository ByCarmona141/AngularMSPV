import { Component, EventEmitter, Input, IterableDiffers, Output } from '@angular/core';
import { BasicList } from './basic-list';
var nextId = 0;
export class DualListComponent {
    constructor(differs) {
        this.differs = differs;
        this.id = `dual-list-${nextId++}`;
        this.key = '_id';
        this.display = '_name';
        this.height = '100px';
        this.filter = false;
        this.format = DualListComponent.DEFAULT_FORMAT;
        this.sort = false;
        this.disabled = false;
        this.destinationChange = new EventEmitter();
        this.sorter = (a, b) => { return (a._name < b._name) ? -1 : ((a._name > b._name) ? 1 : 0); };
        this.available = new BasicList(DualListComponent.AVAILABLE_LIST_NAME);
        this.confirmed = new BasicList(DualListComponent.CONFIRMED_LIST_NAME);
    }
    ngOnChanges(changeRecord) {
        if (changeRecord['filter']) {
            if (changeRecord['filter'].currentValue === false) {
                this.clearFilter(this.available);
                this.clearFilter(this.confirmed);
            }
        }
        if (changeRecord['sort']) {
            if (changeRecord['sort'].currentValue === true && this.compare === undefined) {
                this.compare = this.sorter;
            }
            else if (changeRecord['sort'].currentValue === false) {
                this.compare = undefined;
            }
        }
        if (changeRecord['format']) {
            this.format = changeRecord['format'].currentValue;
            if (typeof (this.format.direction) === 'undefined') {
                this.format.direction = DualListComponent.LTR;
            }
            if (typeof (this.format.add) === 'undefined') {
                this.format.add = DualListComponent.DEFAULT_FORMAT.add;
            }
            if (typeof (this.format.remove) === 'undefined') {
                this.format.remove = DualListComponent.DEFAULT_FORMAT.remove;
            }
            if (typeof (this.format.all) === 'undefined') {
                this.format.all = DualListComponent.DEFAULT_FORMAT.all;
            }
            if (typeof (this.format.none) === 'undefined') {
                this.format.none = DualListComponent.DEFAULT_FORMAT.none;
            }
            if (typeof (this.format.draggable) === 'undefined') {
                this.format.draggable = DualListComponent.DEFAULT_FORMAT.draggable;
            }
        }
        if (changeRecord['source']) {
            this.available = new BasicList(DualListComponent.AVAILABLE_LIST_NAME);
            this.updatedSource();
            this.updatedDestination();
        }
        if (changeRecord['destination']) {
            this.confirmed = new BasicList(DualListComponent.CONFIRMED_LIST_NAME);
            this.updatedDestination();
            this.updatedSource();
        }
    }
    ngDoCheck() {
        if (this.source && this.buildAvailable(this.source)) {
            this.onFilter(this.available);
        }
        if (this.destination && this.buildConfirmed(this.destination)) {
            this.onFilter(this.confirmed);
        }
    }
    buildAvailable(source) {
        const sourceChanges = this.sourceDiffer.diff(source);
        if (sourceChanges) {
            sourceChanges.forEachRemovedItem((r) => {
                const idx = this.findItemIndex(this.available.list, r.item, this.key);
                if (idx !== -1) {
                    this.available.list.splice(idx, 1);
                }
            });
            sourceChanges.forEachAddedItem((r) => {
                // Do not add duplicates even if source has duplicates.
                if (this.findItemIndex(this.available.list, r.item, this.key) === -1) {
                    this.available.list.push({ _id: this.makeId(r.item), _name: this.makeName(r.item) });
                }
            });
            if (this.compare !== undefined) {
                this.available.list.sort(this.compare);
            }
            this.available.sift = this.available.list;
            return true;
        }
        return false;
    }
    buildConfirmed(destination) {
        let moved = false;
        const destChanges = this.destinationDiffer.diff(destination);
        if (destChanges) {
            destChanges.forEachRemovedItem((r) => {
                const idx = this.findItemIndex(this.confirmed.list, r.item, this.key);
                if (idx !== -1) {
                    if (!this.isItemSelected(this.confirmed.pick, this.confirmed.list[idx])) {
                        this.selectItem(this.confirmed.pick, this.confirmed.list[idx]);
                    }
                    this.moveItem(this.confirmed, this.available, this.confirmed.list[idx], false);
                    moved = true;
                }
            });
            destChanges.forEachAddedItem((r) => {
                const idx = this.findItemIndex(this.available.list, r.item, this.key);
                if (idx !== -1) {
                    if (!this.isItemSelected(this.available.pick, this.available.list[idx])) {
                        this.selectItem(this.available.pick, this.available.list[idx]);
                    }
                    this.moveItem(this.available, this.confirmed, this.available.list[idx], false);
                    moved = true;
                }
            });
            if (this.compare !== undefined) {
                this.confirmed.list.sort(this.compare);
            }
            this.confirmed.sift = this.confirmed.list;
            if (moved) {
                this.trueUp();
            }
            return true;
        }
        return false;
    }
    updatedSource() {
        this.available.list.length = 0;
        this.available.pick.length = 0;
        if (this.source !== undefined) {
            this.sourceDiffer = this.differs.find(this.source).create(null);
        }
    }
    updatedDestination() {
        if (this.destination !== undefined) {
            this.destinationDiffer = this.differs.find(this.destination).create(null);
        }
    }
    direction() {
        return this.format.direction === DualListComponent.LTR;
    }
    dragEnd(list = null) {
        if (list) {
            list.dragStart = false;
        }
        else {
            this.available.dragStart = false;
            this.confirmed.dragStart = false;
        }
        return false;
    }
    drag(event, item, list) {
        if (!this.isItemSelected(list.pick, item)) {
            this.selectItem(list.pick, item);
        }
        list.dragStart = true;
        // Set a custom type to be this dual-list's id.
        event.dataTransfer.setData(this.id, item['_id']);
    }
    allowDrop(event, list) {
        if (event.dataTransfer.types.length && (event.dataTransfer.types[0] === this.id)) {
            event.preventDefault();
            if (!list.dragStart) {
                list.dragOver = true;
            }
        }
        return false;
    }
    dragLeave() {
        this.available.dragOver = false;
        this.confirmed.dragOver = false;
    }
    drop(event, list) {
        if (event.dataTransfer.types.length && (event.dataTransfer.types[0] === this.id)) {
            event.preventDefault();
            this.dragLeave();
            this.dragEnd();
            if (list === this.available) {
                this.moveItem(this.available, this.confirmed);
            }
            else {
                this.moveItem(this.confirmed, this.available);
            }
        }
    }
    trueUp() {
        let changed = false;
        // Clear removed items.
        let pos = this.destination.length;
        while ((pos -= 1) >= 0) {
            const mv = this.confirmed.list.filter(conf => {
                if (typeof this.destination[pos] === 'object') {
                    return conf._id === this.destination[pos][this.key];
                }
                else {
                    return conf._id === this.destination[pos];
                }
            });
            if (mv.length === 0) {
                // Not found so remove.
                this.destination.splice(pos, 1);
                changed = true;
            }
        }
        // Push added items.
        for (let i = 0, len = this.confirmed.list.length; i < len; i += 1) {
            let mv = this.destination.filter((d) => {
                if (typeof d === 'object') {
                    return (d[this.key] === this.confirmed.list[i]._id);
                }
                else {
                    return (d === this.confirmed.list[i]._id);
                }
            });
            if (mv.length === 0) {
                // Not found so add.
                mv = this.source.filter((o) => {
                    if (typeof o === 'object') {
                        return (o[this.key] === this.confirmed.list[i]._id);
                    }
                    else {
                        return (o === this.confirmed.list[i]._id);
                    }
                });
                if (mv.length > 0) {
                    this.destination.push(mv[0]);
                    changed = true;
                }
            }
        }
        if (changed) {
            this.destinationChange.emit(this.destination);
        }
    }
    findItemIndex(list, item, key = '_id') {
        let idx = -1;
        function matchObject(e) {
            if (e._id === item[key]) {
                idx = list.indexOf(e);
                return true;
            }
            return false;
        }
        function match(e) {
            if (e._id === item) {
                idx = list.indexOf(e);
                return true;
            }
            return false;
        }
        // Assumption is that the arrays do not have duplicates.
        if (typeof item === 'object') {
            list.filter(matchObject);
        }
        else {
            list.filter(match);
        }
        return idx;
    }
    makeUnavailable(source, item) {
        const idx = source.list.indexOf(item);
        if (idx !== -1) {
            source.list.splice(idx, 1);
        }
    }
    moveItem(source, target, item = null, trueup = true) {
        let i = 0;
        let len = source.pick.length;
        if (item) {
            i = source.list.indexOf(item);
            len = i + 1;
        }
        for (; i < len; i += 1) {
            // Is the pick still in list?
            let mv = [];
            if (item) {
                const idx = this.findItemIndex(source.pick, item);
                if (idx !== -1) {
                    mv[0] = source.pick[idx];
                }
            }
            else {
                mv = source.list.filter(src => {
                    return (src._id === source.pick[i]._id);
                });
            }
            // Should only ever be 1
            if (mv.length === 1) {
                // Add if not already in target.
                if (target.list.filter(trg => trg._id === mv[0]._id).length === 0) {
                    target.list.push(mv[0]);
                }
                this.makeUnavailable(source, mv[0]);
            }
        }
        if (this.compare !== undefined) {
            target.list.sort(this.compare);
        }
        source.pick.length = 0;
        // Update destination
        if (trueup) {
            this.trueUp();
        }
        // Delay ever-so-slightly to prevent race condition.
        setTimeout(() => {
            this.onFilter(source);
            this.onFilter(target);
        }, 10);
    }
    isItemSelected(list, item) {
        if (list.filter(e => Object.is(e, item)).length > 0) {
            return true;
        }
        return false;
    }
    shiftClick(event, index, source, item) {
        if (event.shiftKey && source.last && !Object.is(item, source.last)) {
            const idx = source.sift.indexOf(source.last);
            if (index > idx) {
                for (let i = (idx + 1); i < index; i += 1) {
                    this.selectItem(source.pick, source.sift[i]);
                }
            }
            else if (idx !== -1) {
                for (let i = (index + 1); i < idx; i += 1) {
                    this.selectItem(source.pick, source.sift[i]);
                }
            }
        }
        source.last = item;
    }
    selectItem(list, item) {
        const pk = list.filter((e) => {
            return Object.is(e, item);
        });
        if (pk.length > 0) {
            // Already in list, so deselect.
            for (let i = 0, len = pk.length; i < len; i += 1) {
                const idx = list.indexOf(pk[i]);
                if (idx !== -1) {
                    list.splice(idx, 1);
                }
            }
        }
        else {
            list.push(item);
        }
    }
    selectAll(source) {
        source.pick.length = 0;
        source.pick = source.sift.slice(0);
    }
    selectNone(source) {
        source.pick.length = 0;
    }
    isAllSelected(source) {
        if (source.list.length === 0 || source.list.length === source.pick.length) {
            return true;
        }
        return false;
    }
    isAnySelected(source) {
        if (source.pick.length > 0) {
            return true;
        }
        return false;
    }
    unpick(source) {
        for (let i = source.pick.length - 1; i >= 0; i -= 1) {
            if (source.sift.indexOf(source.pick[i]) === -1) {
                source.pick.splice(i, 1);
            }
        }
    }
    clearFilter(source) {
        if (source) {
            source.picker = '';
            this.onFilter(source);
        }
    }
    onFilter(source) {
        if (source.picker.length > 0) {
            try {
                const filtered = source.list.filter((item) => {
                    if (Object.prototype.toString.call(item) === '[object Object]') {
                        if (item._name !== undefined) {
                            // @ts-ignore: remove when d.ts has locale as an argument.
                            return item._name.toLocaleLowerCase(this.format.locale).indexOf(source.picker.toLocaleLowerCase(this.format.locale)) !== -1;
                        }
                        else {
                            // @ts-ignore: remove when d.ts has locale as an argument.
                            return JSON.stringify(item).toLocaleLowerCase(this.format.locale).indexOf(source.picker.toLocaleLowerCase(this.format.locale)) !== -1;
                        }
                    }
                    else {
                        // @ts-ignore: remove when d.ts has locale as an argument.
                        return item.toLocaleLowerCase(this.format.locale).indexOf(source.picker.toLocaleLowerCase(this.format.locale)) !== -1;
                    }
                });
                source.sift = filtered;
                this.unpick(source);
            }
            catch (e) {
                if (e instanceof RangeError) {
                    this.format.locale = undefined;
                }
                source.sift = source.list;
            }
        }
        else {
            source.sift = source.list;
        }
    }
    makeId(item) {
        if (typeof item === 'object') {
            return item[this.key];
        }
        else {
            return item;
        }
    }
    // Allow for complex names by passing an array of strings.
    // Example: [display]="[ '_type.substring(0,1)', '_name' ]"
    makeName(item, separator = '_') {
        const display = this.display;
        function fallback(itm) {
            switch (Object.prototype.toString.call(itm)) {
                case '[object Number]':
                    return itm;
                case '[object String]':
                    return itm;
                default:
                    if (itm !== undefined) {
                        return itm[display];
                    }
                    else {
                        return 'undefined';
                    }
            }
        }
        let str = '';
        if (this.display !== undefined) {
            switch (Object.prototype.toString.call(this.display)) {
                case '[object Function]':
                    str = this.display(item);
                    break;
                case '[object Array]':
                    for (let i = 0, len = this.display.length; i < len; i += 1) {
                        if (str.length > 0) {
                            str = str + separator;
                        }
                        if (this.display[i].indexOf('.') === -1) {
                            // Simple, just add to string.
                            str = str + item[this.display[i]];
                        }
                        else {
                            // Complex, some action needs to be performed
                            const parts = this.display[i].split('.');
                            const s = item[parts[0]];
                            if (s) {
                                // Use brute force
                                if (parts[1].indexOf('substring') !== -1) {
                                    const nums = (parts[1].substring(parts[1].indexOf('(') + 1, parts[1].indexOf(')'))).split(',');
                                    switch (nums.length) {
                                        case 1:
                                            str = str + s.substring(parseInt(nums[0], 10));
                                            break;
                                        case 2:
                                            str = str + s.substring(parseInt(nums[0], 10), parseInt(nums[1], 10));
                                            break;
                                        default:
                                            str = str + s;
                                            break;
                                    }
                                }
                                else {
                                    // method not approved, so just add s.
                                    str = str + s;
                                }
                            }
                        }
                    }
                    break;
                default:
                    str = fallback(item);
                    break;
            }
        }
        else {
            str = fallback(item);
        }
        return str;
    }
}
DualListComponent.AVAILABLE_LIST_NAME = 'available';
DualListComponent.CONFIRMED_LIST_NAME = 'confirmed';
DualListComponent.LTR = 'left-to-right';
DualListComponent.RTL = 'right-to-left';
DualListComponent.DEFAULT_FORMAT = {
    add: 'Add',
    remove: 'Remove',
    all: 'All',
    none: 'None',
    direction: DualListComponent.LTR,
    draggable: true,
    locale: undefined
};
DualListComponent.decorators = [
    { type: Component, args: [{
                selector: 'dual-list',
                template: "<div class=\"dual-list\">\n\t<div class=\"listbox\" [ngStyle]=\"{ 'order' :  direction() ? 1 : 2, 'margin-left' : direction() ? 0 : '10px' }\">\n\t\t<button type=\"button\" name=\"addBtn\" class=\"btn btn-primary btn-block\"\n\t\t\t(click)=\"moveItem(available, confirmed)\" [ngClass]=\"direction() ? 'point-right' : 'point-left'\"\n\t\t\t[disabled]=\"available.pick.length === 0\">{{format.add}}</button>\n\n\t\t<form *ngIf=\"filter\" class=\"filter\">\n\t\t\t<input class=\"form-control\" name=\"filterSource\" [(ngModel)]=\"available.picker\" (ngModelChange)=\"onFilter(available)\">\n\t\t</form>\n\n\t\t<div class=\"record-picker\">\n\t\t\t<ul [ngStyle]=\"{'max-height': height, 'min-height': height}\" [ngClass]=\"{over:available.dragOver}\"\n\t\t\t\t(drop)=\"drop($event, confirmed)\" (dragover)=\"allowDrop($event, available)\" (dragleave)=\"dragLeave()\">\n\t\t\t\t<li *ngFor=\"let item of available.sift; let idx=index;\"\n\t\t\t\t\t(click)=\"disabled ? null : selectItem(available.pick, item); shiftClick($event, idx, available, item)\"\n\t\t\t\t\t[ngClass]=\"{selected: isItemSelected(available.pick, item), disabled: disabled}\"\n\t\t\t\t\t[draggable]=\"!disabled && format.draggable\" (dragstart)=\"drag($event, item, available)\" (dragend)=\"dragEnd(available)\"\n\t\t\t\t><label>{{item._name}}</label></li>\n\t\t\t</ul>\n\t\t</div>\n\n\t\t<div class=\"button-bar\">\n\t\t\t<button type=\"button\" class=\"btn btn-primary pull-left\" (click)=\"selectAll(available)\"\n\t\t\t\t[disabled]=\"disabled || isAllSelected(available)\">{{format.all}}</button>\n\t\t\t<button type=\"button\" class=\"btn btn-default pull-right\" (click)=\"selectNone(available)\"\n\t\t\t\t[disabled]=\"!isAnySelected(available)\">{{format.none}}</button>\n\t\t</div>\n\t</div>\n\n\t<div class=\"listbox\" [ngStyle]=\"{ 'order' : direction() ? 2 : 1, 'margin-left' : direction() ? '10px' : 0 }\">\n\t\t<button type=\"button\" name=\"removeBtn\" class=\"btn btn-primary btn-block\"\n\t\t\t(click)=\"moveItem(confirmed, available)\" [ngClass]=\"direction() ? 'point-left' : 'point-right'\"\n\t\t\t[disabled]=\"confirmed.pick.length === 0\">{{format.remove}}</button>\n\n\t\t<form *ngIf=\"filter\" class=\"filter\">\n\t\t\t<input class=\"form-control\" name=\"filterDestination\" [(ngModel)]=\"confirmed.picker\" (ngModelChange)=\"onFilter(confirmed)\">\n\t\t</form>\n\n\t\t<div class=\"record-picker\">\n\t\t\t<ul [ngStyle]=\"{'max-height': height, 'min-height': height}\" [ngClass]=\"{over:confirmed.dragOver}\"\n\t\t\t\t(drop)=\"drop($event, available)\" (dragover)=\"allowDrop($event, confirmed)\" (dragleave)=\"dragLeave()\">\n\t\t\t\t<li #itmConf *ngFor=\"let item of confirmed.sift; let idx=index;\"\n\t\t\t\t\t(click)=\"disabled ? null : selectItem(confirmed.pick, item); shiftClick($event, idx, confirmed, item)\"\n\t\t\t\t\t[ngClass]=\"{selected: isItemSelected(confirmed.pick, item), disabled: disabled}\"\n\t\t\t\t\t[draggable]=\"!disabled && format.draggable\" (dragstart)=\"drag($event, item, confirmed)\" (dragend)=\"dragEnd(confirmed)\"\n\t\t\t\t><label>{{item._name}}</label></li>\n\t\t\t</ul>\n\t\t</div>\n\n\t\t<div class=\"button-bar\">\n\t\t\t<button type=\"button\" class=\"btn btn-primary pull-left\" (click)=\"selectAll(confirmed)\"\n\t\t\t\t[disabled]=\"disabled || isAllSelected(confirmed)\">{{format.all}}</button>\n\t\t\t<button type=\"button\" class=\"btn btn-default pull-right\" (click)=\"selectNone(confirmed)\"\n\t\t\t\t[disabled]=\"!isAnySelected(confirmed)\">{{format.none}}</button>\n\t\t</div>\n\t</div>\n</div>\n",
                styles: ["div.record-picker{border:1px solid #ddd;border-radius:8px;cursor:pointer;overflow-x:hidden;overflow-y:auto;position:relative}div.record-picker::-webkit-scrollbar{width:12px}div.record-picker::-webkit-scrollbar-button{height:0;width:0}div.record-picker{scrollbar-3dlight-color:#337ab7;scrollbar-arrow-color:grey;scrollbar-base-color:#337ab7;scrollbar-dark-shadow-color:grey;scrollbar-highlight-color:#337ab7;scrollbar-shadow-color:grey;scrollbar-track-color:#eee}div.record-picker::-webkit-scrollbar-track{background:#eee;border-bottom-right-radius:8px;border-top-right-radius:8px;box-shadow:inset 0 0 3px #dfdfdf}div.record-picker::-webkit-scrollbar-thumb{background:#337ab7;border:thin solid grey;border-bottom-right-radius:8px;border-top-right-radius:8px}div.record-picker::-webkit-scrollbar-thumb:hover{background:#286090}.record-picker ul{margin:0;padding:0 0 1px}.record-picker li{border-bottom:1px solid #ddd;border-top:thin solid #ddd;cursor:pointer;display:block;font-size:.85em;margin-bottom:-1px;min-height:16px;padding:2px 2px 2px 10px;white-space:nowrap}.record-picker li:hover{background-color:#f5f5f5}.record-picker li.selected{background-color:#d9edf7}.record-picker li.selected:hover{background-color:#c4e3f3}.record-picker li.disabled{background-color:inherit;cursor:default;opacity:.5}.record-picker li:first-child{border-top:none;border-top-left-radius:8px;border-top-right-radius:8px}.record-picker li:last-child{border-bottom:none;border-bottom-left-radius:8px;border-bottom-right-radius:8px}.record-picker label{-moz-user-select:none;-ms-user-select:none;-webkit-touch-callout:none;-webkit-user-select:none;cursor:pointer;font-size:14px;font-weight:inherit;margin-bottom:-1px;padding:4px;user-select:none}.record-picker ul.over{background-color:#d3d3d3}.dual-list{align-content:flex-start;display:flex;flex-direction:row}.dual-list .listbox{margin:0;width:50%}.dual-list .button-bar{margin-top:8px}.point-right:after{content:\"\\25B6\";padding-left:1em}.point-left:before{content:\"\\25C0\";padding-right:1em}.dual-list .button-bar button{width:47%}button.btn-block{display:block;margin-bottom:8px;width:100%}.filter{margin-bottom:-2.2em}.filter:after{background-image:url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path d=\"M0 64l192 192v192l128-32V256L512 64H0z\"/></svg>');background-position:50%;background-repeat:no-repeat;color:transparent;content:\"o\";font-size:2em;left:calc(100% - 21px);opacity:.2;position:relative;top:-36px;width:40px}"]
            },] }
];
DualListComponent.ctorParameters = () => [
    { type: IterableDiffers }
];
DualListComponent.propDecorators = {
    id: [{ type: Input }],
    key: [{ type: Input }],
    display: [{ type: Input }],
    height: [{ type: Input }],
    filter: [{ type: Input }],
    format: [{ type: Input }],
    sort: [{ type: Input }],
    compare: [{ type: Input }],
    disabled: [{ type: Input }],
    source: [{ type: Input }],
    destination: [{ type: Input }],
    destinationChange: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHVhbC1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXItZHVhbC1saXN0Ym94L3NyYy9saWIvZHVhbC1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFXLFlBQVksRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUNoRSxNQUFNLEVBQWdCLE1BQU0sZUFBZSxDQUFDO0FBRTdDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFJekMsSUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDO0FBUWYsTUFBTSxPQUFPLGlCQUFpQjtJQXNDN0IsWUFBb0IsT0FBd0I7UUFBeEIsWUFBTyxHQUFQLE9BQU8sQ0FBaUI7UUFyQm5DLE9BQUUsR0FBRyxhQUFhLE1BQU0sRUFBRSxFQUFFLENBQUM7UUFDN0IsUUFBRyxHQUFHLEtBQUssQ0FBQztRQUNaLFlBQU8sR0FBUSxPQUFPLENBQUM7UUFDdkIsV0FBTSxHQUFHLE9BQU8sQ0FBQztRQUNqQixXQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ2YsV0FBTSxHQUFHLGlCQUFpQixDQUFDLGNBQWMsQ0FBQztRQUMxQyxTQUFJLEdBQUcsS0FBSyxDQUFDO1FBRWIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUdoQixzQkFBaUIsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBUXpDLFdBQU0sR0FBRyxDQUFDLENBQU0sRUFBRSxDQUFNLEVBQUUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMs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QixHQUFHLFdBQVcsQ0FBQztBQUVsQyxxQkFBRyxHQUFHLGVBQWUsQ0FBQztBQUN0QixxQkFBRyxHQUFHLGVBQWUsQ0FBQztBQUV0QixnQ0FBYyxHQUFHO0lBQ3ZCLEdBQUcsRUFBRSxLQUFLO0lBQ1YsTUFBTSxFQUFFLFFBQVE7SUFDaEIsR0FBRyxFQUFFLEtBQUs7SUFDVixJQUFJLEVBQUUsTUFBTTtJQUNaLFNBQVMsRUFBRSxpQkFBaUIsQ0FBQyxHQUFHO0lBQ2hDLFNBQVMsRUFBRSxJQUFJO0lBQ2YsTUFBTSxFQUFFLFNBQVM7Q0FDakIsQ0FBQzs7WUFyQkYsU0FBUyxTQUFDO2dCQUNWLFFBQVEsRUFBRSxXQUFXO2dCQUNyQiwwOUdBQXlDOzthQUV6Qzs7O1lBYmlELGVBQWU7OztpQkFnQy9ELEtBQUs7a0JBQ0wsS0FBSztzQkFDTCxLQUFLO3FCQUNMLEtBQUs7cUJBQ0wsS0FBSztxQkFDTCxLQUFLO21CQUNMLEtBQUs7c0JBQ0wsS0FBSzt1QkFDTCxLQUFLO3FCQUNMLEtBQUs7MEJBQ0wsS0FBSztnQ0FDTCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBEb0NoZWNrLCBFdmVudEVtaXR0ZXIsIElucHV0LCBJdGVyYWJsZURpZmZlcnMsIE9uQ2hhbmdlcyxcblx0T3V0cHV0LCBTaW1wbGVDaGFuZ2UgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgQmFzaWNMaXN0IH0gZnJvbSAnLi9iYXNpYy1saXN0JztcblxuZXhwb3J0IHR5cGUgY29tcGFyZUZ1bmN0aW9uID0gKGE6IGFueSwgYjogYW55KSA9PiBudW1iZXI7XG5cbnZhciBuZXh0SWQgPSAwO1xuXG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6ICdkdWFsLWxpc3QnLFxuXHR0ZW1wbGF0ZVVybDogJy4vZHVhbC1saXN0LmNvbXBvbmVudC5odG1sJyxcblx0c3R5bGVVcmxzOiBbICcuL2R1YWwtbGlzdC5jb21wb25lbnQuY3NzJyBdXG59KVxuXG5leHBvcnQgY2xhc3MgRHVhbExpc3RDb21wb25lbnQgaW1wbGVtZW50cyBEb0NoZWNrLCBPbkNoYW5nZXMge1xuXHRzdGF0aWMgQVZBSUxBQkxFX0xJU1RfTkFNRSA9ICdhdmFpbGFibGUnO1xuXHRzdGF0aWMgQ09ORklSTUVEX0xJU1RfTkFNRSA9ICdjb25maXJtZWQnO1xuXG5cdHN0YXRpYyBMVFIgPSAnbGVmdC10by1yaWdodCc7XG5cdHN0YXRpYyBSVEwgPSAncmlnaHQtdG8tbGVmdCc7XG5cblx0c3RhdGljIERFRkFVTFRfRk9STUFUID0ge1xuXHRcdGFkZDogJ0FkZCcsXG5cdFx0cmVtb3ZlOiAnUmVtb3ZlJyxcblx0XHRhbGw6ICdBbGwnLFxuXHRcdG5vbmU6ICdOb25lJyxcblx0XHRkaXJlY3Rpb246IER1YWxMaXN0Q29tcG9uZW50LkxUUixcblx0XHRkcmFnZ2FibGU6IHRydWUsXG5cdFx0bG9jYWxlOiB1bmRlZmluZWRcblx0fTtcblxuXHRASW5wdXQoKSBpZCA9IGBkdWFsLWxpc3QtJHtuZXh0SWQrK31gO1xuXHRASW5wdXQoKSBrZXkgPSAnX2lkJztcblx0QElucHV0KCkgZGlzcGxheTogYW55ID0gJ19uYW1lJztcblx0QElucHV0KCkgaGVpZ2h0ID0gJzEwMHB4Jztcblx0QElucHV0KCkgZmlsdGVyID0gZmFsc2U7XG5cdEBJbnB1dCgpIGZvcm1hdCA9IER1YWxMaXN0Q29tcG9uZW50LkRFRkFVTFRfRk9STUFUO1xuXHRASW5wdXQoKSBzb3J0ID0gZmFsc2U7XG5cdEBJbnB1dCgpIGNvbXBhcmU6IGNvbXBhcmVGdW5jdGlvbjtcblx0QElucHV0KCkgZGlzYWJsZWQgPSBmYWxzZTtcblx0QElucHV0KCkgc291cmNlOiBBcnJheTxhbnk+O1xuXHRASW5wdXQoKSBkZXN0aW5hdGlvbjogQXJyYXk8YW55Pjtcblx0QE91dHB1dCgpIGRlc3RpbmF0aW9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG5cdGF2YWlsYWJsZTogQmFzaWNMaXN0O1xuXHRjb25maXJtZWQ6IEJhc2ljTGlzdDtcblxuXHRzb3VyY2VEaWZmZXI6IGFueTtcblx0ZGVzdGluYXRpb25EaWZmZXI6IGFueTtcblxuXHRwcml2YXRlIHNvcnRlciA9IChhOiBhbnksIGI6IGFueSkgPT4geyByZXR1cm4gKGEuX25hbWUgPCBiLl9uYW1lKSA/IC0xIDogKChhLl9uYW1lID4gYi5fbmFtZSkgPyAxIDogMCk7IH07XG5cblx0Y29uc3RydWN0b3IocHJpdmF0ZSBkaWZmZXJzOiBJdGVyYWJsZURpZmZlcnMpIHtcblx0XHR0aGlzLmF2YWlsYWJsZSA9IG5ldyBCYXNpY0xpc3QoRHVhbExpc3RDb21wb25lbnQuQVZBSUxBQkxFX0xJU1RfTkFNRSk7XG5cdFx0dGhpcy5jb25maXJtZWQgPSBuZXcgQmFzaWNMaXN0KER1YWxMaXN0Q29tcG9uZW50LkNPTkZJUk1FRF9MSVNUX05BTUUpO1xuXHR9XG5cblx0bmdPbkNoYW5nZXMoY2hhbmdlUmVjb3JkOiB7W2tleTogc3RyaW5nXTogU2ltcGxlQ2hhbmdlfSkge1xuXHRcdGlmIChjaGFuZ2VSZWNvcmRbJ2ZpbHRlciddKSB7XG5cdFx0XHRpZiAoY2hhbmdlUmVjb3JkWydmaWx0ZXInXS5jdXJyZW50VmFsdWUgPT09IGZhbHNlKSB7XG5cdFx0XHRcdHRoaXMuY2xlYXJGaWx0ZXIodGhpcy5hdmFpbGFibGUpO1xuXHRcdFx0XHR0aGlzLmNsZWFyRmlsdGVyKHRoaXMuY29uZmlybWVkKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoY2hhbmdlUmVjb3JkWydzb3J0J10pIHtcblx0XHRcdGlmIChjaGFuZ2VSZWNvcmRbJ3NvcnQnXS5jdXJyZW50VmFsdWUgPT09IHRydWUgJiYgdGhpcy5jb21wYXJlID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0dGhpcy5jb21wYXJlID0gdGhpcy5zb3J0ZXI7XG5cdFx0XHR9IGVsc2UgaWYgKGNoYW5nZVJlY29yZFsnc29ydCddLmN1cnJlbnRWYWx1ZSA9PT0gZmFsc2UpIHtcblx0XHRcdFx0dGhpcy5jb21wYXJlID0gdW5kZWZpbmVkO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChjaGFuZ2VSZWNvcmRbJ2Zvcm1hdCddKSB7XG5cdFx0XHR0aGlzLmZvcm1hdCA9IGNoYW5nZVJlY29yZFsnZm9ybWF0J10uY3VycmVudFZhbHVlO1xuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZm9ybWF0LmRpcmVjdGlvbikgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuZm9ybWF0LmRpcmVjdGlvbiA9IER1YWxMaXN0Q29tcG9uZW50LkxUUjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZvcm1hdC5hZGQpID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLmZvcm1hdC5hZGQgPSBEdWFsTGlzdENvbXBvbmVudC5ERUZBVUxUX0ZPUk1BVC5hZGQ7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5mb3JtYXQucmVtb3ZlKSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5mb3JtYXQucmVtb3ZlID0gRHVhbExpc3RDb21wb25lbnQuREVGQVVMVF9GT1JNQVQucmVtb3ZlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKHRoaXMuZm9ybWF0LmFsbCkgPT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuZm9ybWF0LmFsbCA9IER1YWxMaXN0Q29tcG9uZW50LkRFRkFVTFRfRk9STUFULmFsbDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZih0aGlzLmZvcm1hdC5ub25lKSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5mb3JtYXQubm9uZSA9IER1YWxMaXN0Q29tcG9uZW50LkRFRkFVTFRfRk9STUFULm5vbmU7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YodGhpcy5mb3JtYXQuZHJhZ2dhYmxlKSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy5mb3JtYXQuZHJhZ2dhYmxlID0gRHVhbExpc3RDb21wb25lbnQuREVGQVVMVF9GT1JNQVQuZHJhZ2dhYmxlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChjaGFuZ2VSZWNvcmRbJ3NvdXJjZSddKSB7XG5cdFx0XHR0aGlzLmF2YWlsYWJsZSA9IG5ldyBCYXNpY0xpc3QoRHVhbExpc3RDb21wb25lbnQuQVZBSUxBQkxFX0xJU1RfTkFNRSk7XG5cdFx0XHR0aGlzLnVwZGF0ZWRTb3VyY2UoKTtcblx0XHRcdHRoaXMudXBkYXRlZERlc3RpbmF0aW9uKCk7XG5cdFx0fVxuXG5cdFx0aWYgKGNoYW5nZVJlY29yZFsnZGVzdGluYXRpb24nXSkge1xuXHRcdFx0dGhpcy5jb25maXJtZWQgPSBuZXcgQmFzaWNMaXN0KER1YWxMaXN0Q29tcG9uZW50LkNPTkZJUk1FRF9MSVNUX05BTUUpO1xuXHRcdFx0dGhpcy51cGRhdGVkRGVzdGluYXRpb24oKTtcblx0XHRcdHRoaXMudXBkYXRlZFNvdXJjZSgpO1xuXHRcdH1cblx0fVxuXG5cdG5nRG9DaGVjaygpIHtcblx0XHRpZiAodGhpcy5zb3VyY2UgJiYgdGhpcy5idWlsZEF2YWlsYWJsZSh0aGlzLnNvdXJjZSkpIHtcblx0XHRcdHRoaXMub25GaWx0ZXIodGhpcy5hdmFpbGFibGUpO1xuXHRcdH1cblx0XHRpZiAodGhpcy5kZXN0aW5hdGlvbiAmJiB0aGlzLmJ1aWxkQ29uZmlybWVkKHRoaXMuZGVzdGluYXRpb24pKSB7XG5cdFx0XHR0aGlzLm9uRmlsdGVyKHRoaXMuY29uZmlybWVkKTtcblx0XHR9XG5cdH1cblxuXHRidWlsZEF2YWlsYWJsZShzb3VyY2U6IEFycmF5PGFueT4pOiBib29sZWFuIHtcblx0XHRjb25zdCBzb3VyY2VDaGFuZ2VzID0gdGhpcy5zb3VyY2VEaWZmZXIuZGlmZihzb3VyY2UpO1xuXHRcdGlmIChzb3VyY2VDaGFuZ2VzKSB7XG5cdFx0XHRzb3VyY2VDaGFuZ2VzLmZvckVhY2hSZW1vdmVkSXRlbSgocjogYW55KSA9PiB7XG5cdFx0XHRcdGNvbnN0IGlkeCA9IHRoaXMuZmluZEl0ZW1JbmRleCh0aGlzLmF2YWlsYWJsZS5saXN0LCByLml0ZW0sIHRoaXMua2V5KTtcblx0XHRcdFx0aWYgKGlkeCAhPT0gLTEpIHtcblx0XHRcdFx0XHR0aGlzLmF2YWlsYWJsZS5saXN0LnNwbGljZShpZHgsIDEpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0c291cmNlQ2hhbmdlcy5mb3JFYWNoQWRkZWRJdGVtKChyOiBhbnkpID0+IHtcblx0XHRcdFx0Ly8gRG8gbm90IGFkZCBkdXBsaWNhdGVzIGV2ZW4gaWYgc291cmNlIGhhcyBkdXBsaWNhdGVzLlxuXHRcdFx0XHRpZiAodGhpcy5maW5kSXRlbUluZGV4KHRoaXMuYXZhaWxhYmxlLmxpc3QsIHIuaXRlbSwgdGhpcy5rZXkpID09PSAtMSkge1xuXHRcdFx0XHRcdHRoaXMuYXZhaWxhYmxlLmxpc3QucHVzaCggeyBfaWQ6IHRoaXMubWFrZUlkKHIuaXRlbSksIF9uYW1lOiB0aGlzLm1ha2VOYW1lKHIuaXRlbSkgfSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRpZiAodGhpcy5jb21wYXJlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0dGhpcy5hdmFpbGFibGUubGlzdC5zb3J0KHRoaXMuY29tcGFyZSk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLmF2YWlsYWJsZS5zaWZ0ID0gdGhpcy5hdmFpbGFibGUubGlzdDtcblxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdGJ1aWxkQ29uZmlybWVkKGRlc3RpbmF0aW9uOiBBcnJheTxhbnk+KTogYm9vbGVhbiB7XG5cdFx0bGV0IG1vdmVkID0gZmFsc2U7XG5cdFx0Y29uc3QgZGVzdENoYW5nZXMgPSB0aGlzLmRlc3RpbmF0aW9uRGlmZmVyLmRpZmYoZGVzdGluYXRpb24pO1xuXHRcdGlmIChkZXN0Q2hhbmdlcykge1xuXHRcdFx0ZGVzdENoYW5nZXMuZm9yRWFjaFJlbW92ZWRJdGVtKChyOiBhbnkpID0+IHtcblx0XHRcdFx0Y29uc3QgaWR4ID0gdGhpcy5maW5kSXRlbUluZGV4KHRoaXMuY29uZmlybWVkLmxpc3QsIHIuaXRlbSwgdGhpcy5rZXkpO1xuXHRcdFx0XHRpZiAoaWR4ICE9PSAtMSkge1xuXHRcdFx0XHRcdGlmICghdGhpcy5pc0l0ZW1TZWxlY3RlZCh0aGlzLmNvbmZpcm1lZC5waWNrLCB0aGlzLmNvbmZpcm1lZC5saXN0W2lkeF0pKSB7XG5cdFx0XHRcdFx0XHR0aGlzLnNlbGVjdEl0ZW0odGhpcy5jb25maXJtZWQucGljaywgdGhpcy5jb25maXJtZWQubGlzdFtpZHhdKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0dGhpcy5tb3ZlSXRlbSh0aGlzLmNvbmZpcm1lZCwgdGhpcy5hdmFpbGFibGUsIHRoaXMuY29uZmlybWVkLmxpc3RbaWR4XSwgZmFsc2UpO1xuXHRcdFx0XHRcdG1vdmVkID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGRlc3RDaGFuZ2VzLmZvckVhY2hBZGRlZEl0ZW0oKHI6IGFueSkgPT4ge1xuXHRcdFx0XHRjb25zdCBpZHggPSB0aGlzLmZpbmRJdGVtSW5kZXgodGhpcy5hdmFpbGFibGUubGlzdCwgci5pdGVtLCB0aGlzLmtleSk7XG5cdFx0XHRcdGlmIChpZHggIT09IC0xKSB7XG5cdFx0XHRcdFx0aWYgKCF0aGlzLmlzSXRlbVNlbGVjdGVkKHRoaXMuYXZhaWxhYmxlLnBpY2ssIHRoaXMuYXZhaWxhYmxlLmxpc3RbaWR4XSkpIHtcblx0XHRcdFx0XHRcdHRoaXMuc2VsZWN0SXRlbSh0aGlzLmF2YWlsYWJsZS5waWNrLCB0aGlzLmF2YWlsYWJsZS5saXN0W2lkeF0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHR0aGlzLm1vdmVJdGVtKHRoaXMuYXZhaWxhYmxlLCB0aGlzLmNvbmZpcm1lZCwgdGhpcy5hdmFpbGFibGUubGlzdFtpZHhdLCBmYWxzZSk7XG5cdFx0XHRcdFx0bW92ZWQgPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKHRoaXMuY29tcGFyZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdHRoaXMuY29uZmlybWVkLmxpc3Quc29ydCh0aGlzLmNvbXBhcmUpO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5jb25maXJtZWQuc2lmdCA9IHRoaXMuY29uZmlybWVkLmxpc3Q7XG5cblx0XHRcdGlmIChtb3ZlZCkge1xuXHRcdFx0XHR0aGlzLnRydWVVcCgpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHVwZGF0ZWRTb3VyY2UoKSB7XG5cdFx0dGhpcy5hdmFpbGFibGUubGlzdC5sZW5ndGggPSAwO1xuXHRcdHRoaXMuYXZhaWxhYmxlLnBpY2subGVuZ3RoID0gMDtcblxuXHRcdGlmICh0aGlzLnNvdXJjZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHR0aGlzLnNvdXJjZURpZmZlciA9IHRoaXMuZGlmZmVycy5maW5kKHRoaXMuc291cmNlKS5jcmVhdGUobnVsbCk7XG5cdFx0fVxuXHR9XG5cblx0dXBkYXRlZERlc3RpbmF0aW9uKCkge1xuXHRcdGlmICh0aGlzLmRlc3RpbmF0aW9uICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdHRoaXMuZGVzdGluYXRpb25EaWZmZXIgPSB0aGlzLmRpZmZlcnMuZmluZCh0aGlzLmRlc3RpbmF0aW9uKS5jcmVhdGUobnVsbCk7XG5cdFx0fVxuXHR9XG5cblx0ZGlyZWN0aW9uKCkge1xuXHRcdHJldHVybiB0aGlzLmZvcm1hdC5kaXJlY3Rpb24gPT09IER1YWxMaXN0Q29tcG9uZW50LkxUUjtcblx0fVxuXG5cdGRyYWdFbmQobGlzdDogQmFzaWNMaXN0ID0gbnVsbCk6IGJvb2xlYW4ge1xuXHRcdGlmIChsaXN0KSB7XG5cdFx0XHRsaXN0LmRyYWdTdGFydCA9IGZhbHNlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmF2YWlsYWJsZS5kcmFnU3RhcnQgPSBmYWxzZTtcblx0XHRcdHRoaXMuY29uZmlybWVkLmRyYWdTdGFydCA9IGZhbHNlO1xuXHRcdH1cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRkcmFnKGV2ZW50OiBEcmFnRXZlbnQsIGl0ZW06IGFueSwgbGlzdDogQmFzaWNMaXN0KSB7XG5cdFx0aWYgKCF0aGlzLmlzSXRlbVNlbGVjdGVkKGxpc3QucGljaywgaXRlbSkpIHtcblx0XHRcdHRoaXMuc2VsZWN0SXRlbShsaXN0LnBpY2ssIGl0ZW0pO1xuXHRcdH1cblx0XHRsaXN0LmRyYWdTdGFydCA9IHRydWU7XG5cblx0XHQvLyBTZXQgYSBjdXN0b20gdHlwZSB0byBiZSB0aGlzIGR1YWwtbGlzdCdzIGlkLlxuXHRcdGV2ZW50LmRhdGFUcmFuc2Zlci5zZXREYXRhKHRoaXMuaWQsIGl0ZW1bJ19pZCddKTtcblx0fVxuXG5cdGFsbG93RHJvcChldmVudDogRHJhZ0V2ZW50LCBsaXN0OiBCYXNpY0xpc3QpOiBib29sZWFuIHtcblx0XHRpZiAoZXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzLmxlbmd0aCAmJiAoZXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzWzBdID09PSB0aGlzLmlkKSkge1xuXHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGlmICghbGlzdC5kcmFnU3RhcnQpIHtcblx0XHRcdFx0bGlzdC5kcmFnT3ZlciA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdGRyYWdMZWF2ZSgpIHtcblx0XHR0aGlzLmF2YWlsYWJsZS5kcmFnT3ZlciA9IGZhbHNlO1xuXHRcdHRoaXMuY29uZmlybWVkLmRyYWdPdmVyID0gZmFsc2U7XG5cdH1cblxuXHRkcm9wKGV2ZW50OiBEcmFnRXZlbnQsIGxpc3Q6IEJhc2ljTGlzdCkge1xuXHRcdGlmIChldmVudC5kYXRhVHJhbnNmZXIudHlwZXMubGVuZ3RoICYmIChldmVudC5kYXRhVHJhbnNmZXIudHlwZXNbMF0gPT09IHRoaXMuaWQpKSB7XG5cdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0dGhpcy5kcmFnTGVhdmUoKTtcblx0XHRcdHRoaXMuZHJhZ0VuZCgpO1xuXG5cdFx0XHRpZiAobGlzdCA9PT0gdGhpcy5hdmFpbGFibGUpIHtcblx0XHRcdFx0dGhpcy5tb3ZlSXRlbSh0aGlzLmF2YWlsYWJsZSwgdGhpcy5jb25maXJtZWQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tb3ZlSXRlbSh0aGlzLmNvbmZpcm1lZCwgdGhpcy5hdmFpbGFibGUpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgdHJ1ZVVwKCkge1xuXHRcdGxldCBjaGFuZ2VkID0gZmFsc2U7XG5cblx0XHQvLyBDbGVhciByZW1vdmVkIGl0ZW1zLlxuXHRcdGxldCBwb3MgPSB0aGlzLmRlc3RpbmF0aW9uLmxlbmd0aDtcblx0XHR3aGlsZSAoKHBvcyAtPSAxKSA+PSAwKSB7XG5cdFx0XHRjb25zdCBtdiA9IHRoaXMuY29uZmlybWVkLmxpc3QuZmlsdGVyKCBjb25mID0+IHtcblx0XHRcdFx0aWYgKHR5cGVvZiB0aGlzLmRlc3RpbmF0aW9uW3Bvc10gPT09ICdvYmplY3QnKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGNvbmYuX2lkID09PSB0aGlzLmRlc3RpbmF0aW9uW3Bvc11bdGhpcy5rZXldO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJldHVybiBjb25mLl9pZCA9PT0gdGhpcy5kZXN0aW5hdGlvbltwb3NdO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdGlmIChtdi5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0Ly8gTm90IGZvdW5kIHNvIHJlbW92ZS5cblx0XHRcdFx0dGhpcy5kZXN0aW5hdGlvbi5zcGxpY2UocG9zLCAxKTtcblx0XHRcdFx0Y2hhbmdlZCA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gUHVzaCBhZGRlZCBpdGVtcy5cblx0XHRmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5jb25maXJtZWQubGlzdC5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkge1xuXHRcdFx0bGV0IG12ID0gdGhpcy5kZXN0aW5hdGlvbi5maWx0ZXIoIChkOiBhbnkpID0+IHtcblx0XHRcdFx0aWYgKHR5cGVvZiBkID09PSAnb2JqZWN0Jykge1xuXHRcdFx0XHRcdHJldHVybiAoZFt0aGlzLmtleV0gPT09IHRoaXMuY29uZmlybWVkLmxpc3RbaV0uX2lkKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gKGQgPT09IHRoaXMuY29uZmlybWVkLmxpc3RbaV0uX2lkKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdGlmIChtdi5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0Ly8gTm90IGZvdW5kIHNvIGFkZC5cblx0XHRcdFx0bXYgPSB0aGlzLnNvdXJjZS5maWx0ZXIoIChvOiBhbnkpID0+IHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIG8gPT09ICdvYmplY3QnKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKG9bdGhpcy5rZXldID09PSB0aGlzLmNvbmZpcm1lZC5saXN0W2ldLl9pZCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJldHVybiAobyA9PT0gdGhpcy5jb25maXJtZWQubGlzdFtpXS5faWQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKG12Lmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHR0aGlzLmRlc3RpbmF0aW9uLnB1c2gobXZbMF0pO1xuXHRcdFx0XHRcdGNoYW5nZWQgPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGNoYW5nZWQpIHtcblx0XHRcdHRoaXMuZGVzdGluYXRpb25DaGFuZ2UuZW1pdCh0aGlzLmRlc3RpbmF0aW9uKTtcblx0XHR9XG5cdH1cblxuXHRmaW5kSXRlbUluZGV4KGxpc3Q6IEFycmF5PGFueT4sIGl0ZW06IGFueSwga2V5OiBhbnkgPSAnX2lkJykge1xuXHRcdGxldCBpZHggPSAtMTtcblxuXHRcdGZ1bmN0aW9uIG1hdGNoT2JqZWN0KGU6IGFueSkge1xuXHRcdFx0aWYgKGUuX2lkID09PSBpdGVtW2tleV0pIHtcblx0XHRcdFx0aWR4ID0gbGlzdC5pbmRleE9mKGUpO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBtYXRjaChlOiBhbnkpIHtcblx0XHRcdGlmIChlLl9pZCA9PT0gaXRlbSkge1xuXHRcdFx0XHRpZHggPSBsaXN0LmluZGV4T2YoZSk7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIEFzc3VtcHRpb24gaXMgdGhhdCB0aGUgYXJyYXlzIGRvIG5vdCBoYXZlIGR1cGxpY2F0ZXMuXG5cdFx0aWYgKHR5cGVvZiBpdGVtID09PSAnb2JqZWN0Jykge1xuXHRcdFx0bGlzdC5maWx0ZXIobWF0Y2hPYmplY3QpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsaXN0LmZpbHRlcihtYXRjaCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGlkeDtcblx0fVxuXG5cdHByaXZhdGUgbWFrZVVuYXZhaWxhYmxlKHNvdXJjZTogQmFzaWNMaXN0LCBpdGVtOiBhbnkpIHtcblx0XHRjb25zdCBpZHggPSBzb3VyY2UubGlzdC5pbmRleE9mKGl0ZW0pO1xuXHRcdGlmIChpZHggIT09IC0xKSB7XG5cdFx0XHRzb3VyY2UubGlzdC5zcGxpY2UoaWR4LCAxKTtcblx0XHR9XG5cdH1cblxuXHRtb3ZlSXRlbShzb3VyY2U6IEJhc2ljTGlzdCwgdGFyZ2V0OiBCYXNpY0xpc3QsIGl0ZW06IGFueSA9IG51bGwsIHRydWV1cCA9IHRydWUpIHtcblx0XHRsZXQgaSA9IDA7XG5cdFx0bGV0IGxlbiA9IHNvdXJjZS5waWNrLmxlbmd0aDtcblxuXHRcdGlmIChpdGVtKSB7XG5cdFx0XHRpID0gc291cmNlLmxpc3QuaW5kZXhPZihpdGVtKTtcblx0XHRcdGxlbiA9IGkgKyAxO1xuXHRcdH1cblxuXHRcdGZvciAoOyBpIDwgbGVuOyBpICs9IDEpIHtcblx0XHRcdC8vIElzIHRoZSBwaWNrIHN0aWxsIGluIGxpc3Q/XG5cdFx0XHRsZXQgbXY6IEFycmF5PGFueT4gPSBbXTtcblx0XHRcdGlmIChpdGVtKSB7XG5cdFx0XHRcdGNvbnN0IGlkeCA9IHRoaXMuZmluZEl0ZW1JbmRleChzb3VyY2UucGljaywgaXRlbSk7XG5cdFx0XHRcdGlmIChpZHggIT09IC0xKSB7XG5cdFx0XHRcdFx0bXZbMF0gPSBzb3VyY2UucGlja1tpZHhdO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRtdiA9IHNvdXJjZS5saXN0LmZpbHRlciggc3JjID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gKHNyYy5faWQgPT09IHNvdXJjZS5waWNrW2ldLl9pZCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBTaG91bGQgb25seSBldmVyIGJlIDFcblx0XHRcdGlmIChtdi5sZW5ndGggPT09IDEpIHtcblx0XHRcdFx0Ly8gQWRkIGlmIG5vdCBhbHJlYWR5IGluIHRhcmdldC5cblx0XHRcdFx0aWYgKHRhcmdldC5saXN0LmZpbHRlcih0cmcgPT4gdHJnLl9pZCA9PT0gbXZbMF0uX2lkKS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0XHR0YXJnZXQubGlzdC5wdXNoKCBtdlswXSApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5tYWtlVW5hdmFpbGFibGUoc291cmNlLCBtdlswXSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuY29tcGFyZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHR0YXJnZXQubGlzdC5zb3J0KHRoaXMuY29tcGFyZSk7XG5cdFx0fVxuXG5cdFx0c291cmNlLnBpY2subGVuZ3RoID0gMDtcblxuXHRcdC8vIFVwZGF0ZSBkZXN0aW5hdGlvblxuXHRcdGlmICh0cnVldXApIHtcblx0XHRcdHRoaXMudHJ1ZVVwKCk7XG5cdFx0fVxuXG5cdFx0Ly8gRGVsYXkgZXZlci1zby1zbGlnaHRseSB0byBwcmV2ZW50IHJhY2UgY29uZGl0aW9uLlxuXHRcdHNldFRpbWVvdXQoICgpID0+IHtcblx0XHRcdHRoaXMub25GaWx0ZXIoc291cmNlKTtcblx0XHRcdHRoaXMub25GaWx0ZXIodGFyZ2V0KTtcblx0XHR9LCAxMCk7XG5cdH1cblxuXHRpc0l0ZW1TZWxlY3RlZChsaXN0OiBBcnJheTxhbnk+LCBpdGVtOiBhbnkpOiBib29sZWFuIHtcblx0XHRpZiAobGlzdC5maWx0ZXIoZSA9PiBPYmplY3QuaXMoZSwgaXRlbSkpLmxlbmd0aCA+IDApIHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRzaGlmdENsaWNrKGV2ZW50OiBNb3VzZUV2ZW50LCBpbmRleDogbnVtYmVyLCBzb3VyY2U6IEJhc2ljTGlzdCwgaXRlbTogYW55KSB7XG5cdFx0aWYgKGV2ZW50LnNoaWZ0S2V5ICYmIHNvdXJjZS5sYXN0ICYmICFPYmplY3QuaXMoaXRlbSwgc291cmNlLmxhc3QpKSB7XG5cdFx0XHRjb25zdCBpZHggPSBzb3VyY2Uuc2lmdC5pbmRleE9mKHNvdXJjZS5sYXN0KTtcblx0XHRcdGlmIChpbmRleCA+IGlkeCkge1xuXHRcdFx0XHRmb3IgKGxldCBpID0gKGlkeCArIDEpOyBpIDwgaW5kZXg7IGkgKz0gMSkge1xuXHRcdFx0XHRcdHRoaXMuc2VsZWN0SXRlbShzb3VyY2UucGljaywgc291cmNlLnNpZnRbaV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKGlkeCAhPT0gLTEpIHtcblx0XHRcdFx0Zm9yIChsZXQgaSA9IChpbmRleCArIDEpOyBpIDwgaWR4OyBpICs9IDEpICB7XG5cdFx0XHRcdFx0dGhpcy5zZWxlY3RJdGVtKHNvdXJjZS5waWNrLCBzb3VyY2Uuc2lmdFtpXSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0c291cmNlLmxhc3QgPSBpdGVtO1xuXHR9XG5cblx0c2VsZWN0SXRlbShsaXN0OiBBcnJheTxhbnk+LCBpdGVtOiBhbnkpIHtcblx0XHRjb25zdCBwayA9IGxpc3QuZmlsdGVyKCAoZTogYW55KSA9PiB7XG5cdFx0XHRyZXR1cm4gT2JqZWN0LmlzKGUsIGl0ZW0pO1xuXHRcdH0pO1xuXHRcdGlmIChway5sZW5ndGggPiAwKSB7XG5cdFx0XHQvLyBBbHJlYWR5IGluIGxpc3QsIHNvIGRlc2VsZWN0LlxuXHRcdFx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IHBrLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7XG5cdFx0XHRcdGNvbnN0IGlkeCA9IGxpc3QuaW5kZXhPZihwa1tpXSk7XG5cdFx0XHRcdGlmIChpZHggIT09IC0xKSB7XG5cdFx0XHRcdFx0bGlzdC5zcGxpY2UoaWR4LCAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRsaXN0LnB1c2goaXRlbSk7XG5cdFx0fVxuXHR9XG5cblx0c2VsZWN0QWxsKHNvdXJjZTogQmFzaWNMaXN0KSB7XG5cdFx0c291cmNlLnBpY2subGVuZ3RoID0gMDtcblx0XHRzb3VyY2UucGljayA9IHNvdXJjZS5zaWZ0LnNsaWNlKDApO1xuXHR9XG5cblx0c2VsZWN0Tm9uZShzb3VyY2U6IEJhc2ljTGlzdCkge1xuXHRcdHNvdXJjZS5waWNrLmxlbmd0aCA9IDA7XG5cdH1cblxuXHRpc0FsbFNlbGVjdGVkKHNvdXJjZTogQmFzaWNMaXN0KTogYm9vbGVhbiB7XG5cdFx0aWYgKHNvdXJjZS5saXN0Lmxlbmd0aCA9PT0gMCB8fCBzb3VyY2UubGlzdC5sZW5ndGggPT09IHNvdXJjZS5waWNrLmxlbmd0aCkge1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdGlzQW55U2VsZWN0ZWQoc291cmNlOiBCYXNpY0xpc3QpOiBib29sZWFuIHtcblx0XHRpZiAoc291cmNlLnBpY2subGVuZ3RoID4gMCkge1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHByaXZhdGUgdW5waWNrKHNvdXJjZTogQmFzaWNMaXN0KSB7XG5cdFx0Zm9yIChsZXQgaSA9IHNvdXJjZS5waWNrLmxlbmd0aCAtIDE7IGkgPj0gMDsgaSAtPSAxKSB7XG5cdFx0XHRpZiAoc291cmNlLnNpZnQuaW5kZXhPZihzb3VyY2UucGlja1tpXSkgPT09IC0xKSB7XG5cdFx0XHRcdHNvdXJjZS5waWNrLnNwbGljZShpLCAxKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRjbGVhckZpbHRlcihzb3VyY2U6IEJhc2ljTGlzdCkge1xuXHRcdGlmIChzb3VyY2UpIHtcblx0XHRcdHNvdXJjZS5waWNrZXIgPSAnJztcblx0XHRcdHRoaXMub25GaWx0ZXIoc291cmNlKTtcblx0XHR9XG5cdH1cblxuXHRvbkZpbHRlcihzb3VyY2U6IEJhc2ljTGlzdCkge1xuXHRcdGlmIChzb3VyY2UucGlja2VyLmxlbmd0aCA+IDApIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGNvbnN0IGZpbHRlcmVkID0gc291cmNlLmxpc3QuZmlsdGVyKCAoaXRlbTogYW55KSA9PiB7XG5cdFx0XHRcdFx0aWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVtKSA9PT0gJ1tvYmplY3QgT2JqZWN0XScpIHtcblx0XHRcdFx0XHRcdGlmIChpdGVtLl9uYW1lICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdFx0Ly8gQHRzLWlnbm9yZTogcmVtb3ZlIHdoZW4gZC50cyBoYXMgbG9jYWxlIGFzIGFuIGFyZ3VtZW50LlxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gaXRlbS5fbmFtZS50b0xvY2FsZUxvd2VyQ2FzZSh0aGlzLmZvcm1hdC5sb2NhbGUpLmluZGV4T2Yoc291cmNlLnBpY2tlci50b0xvY2FsZUxvd2VyQ2FzZSh0aGlzLmZvcm1hdC5sb2NhbGUpKSAhPT0gLTE7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQvLyBAdHMtaWdub3JlOiByZW1vdmUgd2hlbiBkLnRzIGhhcyBsb2NhbGUgYXMgYW4gYXJndW1lbnQuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBKU09OLnN0cmluZ2lmeShpdGVtKS50b0xvY2FsZUxvd2VyQ2FzZSh0aGlzLmZvcm1hdC5sb2NhbGUpLmluZGV4T2Yoc291cmNlLnBpY2tlci50b0xvY2FsZUxvd2VyQ2FzZSh0aGlzLmZvcm1hdC5sb2NhbGUpKSAhPT0gLTE7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8vIEB0cy1pZ25vcmU6IHJlbW92ZSB3aGVuIGQudHMgaGFzIGxvY2FsZSBhcyBhbiBhcmd1bWVudC5cblx0XHRcdFx0XHRcdHJldHVybiBpdGVtLnRvTG9jYWxlTG93ZXJDYXNlKHRoaXMuZm9ybWF0LmxvY2FsZSkuaW5kZXhPZihzb3VyY2UucGlja2VyLnRvTG9jYWxlTG93ZXJDYXNlKHRoaXMuZm9ybWF0LmxvY2FsZSkpICE9PSAtMTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRzb3VyY2Uuc2lmdCA9IGZpbHRlcmVkO1xuXHRcdFx0XHR0aGlzLnVucGljayhzb3VyY2UpO1xuXHRcdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0XHRpZiAoZSBpbnN0YW5jZW9mIFJhbmdlRXJyb3IpIHtcblx0XHRcdFx0XHR0aGlzLmZvcm1hdC5sb2NhbGUgPSB1bmRlZmluZWQ7XG5cdFx0XHRcdH1cblx0XHRcdFx0c291cmNlLnNpZnQgPSBzb3VyY2UubGlzdDtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0c291cmNlLnNpZnQgPSBzb3VyY2UubGlzdDtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIG1ha2VJZChpdGVtOiBhbnkpOiBzdHJpbmcgfCBudW1iZXIge1xuXHRcdGlmICh0eXBlb2YgaXRlbSA9PT0gJ29iamVjdCcpIHtcblx0XHRcdHJldHVybiBpdGVtW3RoaXMua2V5XTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIGl0ZW07XG5cdFx0fVxuXHR9XG5cblx0Ly8gQWxsb3cgZm9yIGNvbXBsZXggbmFtZXMgYnkgcGFzc2luZyBhbiBhcnJheSBvZiBzdHJpbmdzLlxuXHQvLyBFeGFtcGxlOiBbZGlzcGxheV09XCJbICdfdHlwZS5zdWJzdHJpbmcoMCwxKScsICdfbmFtZScgXVwiXG5cdHByb3RlY3RlZCBtYWtlTmFtZShpdGVtOiBhbnksIHNlcGFyYXRvciA9ICdfJyk6IHN0cmluZyB7XG5cdFx0Y29uc3QgZGlzcGxheSA9IHRoaXMuZGlzcGxheTtcblxuXHRcdGZ1bmN0aW9uIGZhbGxiYWNrKGl0bTogYW55KSB7XG5cdFx0XHRzd2l0Y2ggKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdG0pKSB7XG5cdFx0XHRjYXNlICdbb2JqZWN0IE51bWJlcl0nOlxuXHRcdFx0XHRyZXR1cm4gaXRtO1xuXHRcdFx0Y2FzZSAnW29iamVjdCBTdHJpbmddJzpcblx0XHRcdFx0cmV0dXJuIGl0bTtcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGlmIChpdG0gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdHJldHVybiBpdG1bZGlzcGxheV07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuICd1bmRlZmluZWQnO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0bGV0IHN0ciA9ICcnO1xuXG5cdFx0aWYgKHRoaXMuZGlzcGxheSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRzd2l0Y2ggKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0aGlzLmRpc3BsYXkpKSB7XG5cdFx0XHRjYXNlICdbb2JqZWN0IEZ1bmN0aW9uXSc6XG5cdFx0XHRcdHN0ciA9IHRoaXMuZGlzcGxheShpdGVtKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgJ1tvYmplY3QgQXJyYXldJzpcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuZGlzcGxheS5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkge1xuXHRcdFx0XHRcdGlmIChzdHIubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0c3RyID0gc3RyICsgc2VwYXJhdG9yO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0aGlzLmRpc3BsYXlbaV0uaW5kZXhPZignLicpID09PSAtMSkge1xuXHRcdFx0XHRcdFx0Ly8gU2ltcGxlLCBqdXN0IGFkZCB0byBzdHJpbmcuXG5cdFx0XHRcdFx0XHRzdHIgPSBzdHIgKyBpdGVtW3RoaXMuZGlzcGxheVtpXV07XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdC8vIENvbXBsZXgsIHNvbWUgYWN0aW9uIG5lZWRzIHRvIGJlIHBlcmZvcm1lZFxuXHRcdFx0XHRcdFx0Y29uc3QgcGFydHMgPSB0aGlzLmRpc3BsYXlbaV0uc3BsaXQoJy4nKTtcblxuXHRcdFx0XHRcdFx0Y29uc3QgcyA9IGl0ZW1bcGFydHNbMF1dO1xuXHRcdFx0XHRcdFx0aWYgKHMpIHtcblx0XHRcdFx0XHRcdFx0Ly8gVXNlIGJydXRlIGZvcmNlXG5cdFx0XHRcdFx0XHRcdGlmIChwYXJ0c1sxXS5pbmRleE9mKCdzdWJzdHJpbmcnKSAhPT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0XHRjb25zdCBudW1zID0gKHBhcnRzWzFdLnN1YnN0cmluZyhwYXJ0c1sxXS5pbmRleE9mKCcoJykgKyAxLCBwYXJ0c1sxXS5pbmRleE9mKCcpJykpKS5zcGxpdCgnLCcpO1xuXG5cdFx0XHRcdFx0XHRcdFx0c3dpdGNoIChudW1zLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0XHRcdGNhc2UgMTpcblx0XHRcdFx0XHRcdFx0XHRcdHN0ciA9IHN0ciArIHMuc3Vic3RyaW5nKHBhcnNlSW50KG51bXNbMF0sIDEwKSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0XHRjYXNlIDI6XG5cdFx0XHRcdFx0XHRcdFx0XHRzdHIgPSBzdHIgKyBzLnN1YnN0cmluZyhwYXJzZUludChudW1zWzBdLCAxMCksIHBhcnNlSW50KG51bXNbMV0sIDEwKSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0XHRcdFx0c3RyID0gc3RyICsgcztcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHQvLyBtZXRob2Qgbm90IGFwcHJvdmVkLCBzbyBqdXN0IGFkZCBzLlxuXHRcdFx0XHRcdFx0XHRcdHN0ciA9IHN0ciArIHM7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRzdHIgPSBmYWxsYmFjayhpdGVtKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHN0ciA9IGZhbGxiYWNrKGl0ZW0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBzdHI7XG5cdH1cbn1cbiJdfQ==